{% extends "budget/expenses/expense.html" %}
{% load static %}
{% load bootstrap_pagination %}

{% block page_title %}Expenses{% endblock page_title %}

{% block extra_styles %}
<link rel="stylesheet" type="text/css" href="{% static 'budget/list.css' %}">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />

<link rel="stylesheet" type="text/css" href="{% static 'budget/rangeSlider/nouislider.css' %}">

{% endblock extra_styles %}

{% block hist-activ %}active imp{% endblock %}

{% block content %}

  {% if messages %}
    {% for message in messages %}
      {% if message.tags == "error" %}
      <div class="alert alert-danger alert-dismissible fade show" role="alert">
      {% else %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
      {% endif %}
      {{ message }}
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
    {% endfor %}
  {% endif %}
  <div id="filters-and-list">
     
    <form id="filter-form" action="{% url 'budget:expense_list' %}" method="GET" class="mt-3" enctype="application/x-www-form-urlencoded"> 
      
      <div id="search-section" class="mb-3">
        <label for="keywords" class="imp">Keywords</label>
        {{ form.keywords }}
      </div>  

      <div id="date-section" class="mb-3">
        <label id="singledate-label" for="singledate" class="imp">Date</label>
        <label id="daterange-label" for="daterange" class="imp d-none">Date Range</label>
        <div id="date-check" class="custom-control custom-checkbox mb-2">
          {{ form.all_dates}}
          <label class="custom-control-label" for="all-dates">All dates</label>
        </div>
        <div class="flex align-center">
          {% comment %}
          <input id="singledate" type="text" name="singledate" class="form-control w-50" aria-describedby="date"/>
          <input id="daterange" type="text" name="daterange" class="form-control w-50 d-none" aria-describedby="dateRange"/>
          {% endcomment %}
          {{ form.single_date }}
          {{ form.date_range }}
          <div id="date-check" class="custom-control custom-checkbox ml-2">
            {% comment %}
            <input type="checkbox" class="custom-control-input" id="use-range" name="use-range">
            {% endcomment %}
            {{ form.use_range}}
            <label class="custom-control-label" for="use-range">Date range</label>
          </div>
        </div>
      </div>

      <div id="amount-section" class="mb-3">  
        <p class="imp mb-3">Amount</p>  
        <div id="slider" class="mb-2"></div> 
        <div id="amount-labels" class="flex align-center date-modal-body">
          <label for="min-amount" class="">Min</label>
          <span></span>
          <label for="max-amount" class="">Max</label>
        </div>

        <div id="amount-inputs" class="flex align-center just-betw date-modal-body">
          {{ form.min_amount }}
          <span class="flex just-center" ><i class="fas fa-angle-right fa-lg"></i></span>
          {{ form.max_amount }}
        </div>
      </div>

      <div id="category-section" class="mb-3">
        <p class="imp mb-1">Categories</p>
        {% for category in form.categories %}
        <div class="custom-control custom-checkbox">
          {{ category.tag }}
          <label class="custom-control-label" for="{{ category.id_for_label }}">{{ category.choice_label }}</label>
        </div>
        {% endfor %}
      </div>

      <div id="receipt-section" class="mb-3">
        <p class="imp mb-1">Receipt</p>
        {% for radio in form.has_receipt %}
        <div class="form-check form-check-inline">
          {{ radio.tag }}
          <label class="form-check-label" for="{{ radio.id_for_label }}">
            {{ radio.choice_label}}
          </label>
        </div>
        {% endfor %}
      </div>
      
      <button type="submit" class="btn btn-outline-primary imp block"><i class="fas fa-search" aria-hidden="true"></i> Save Filters</button>
    </form>
  
    {% if page_obj %}
    <div class="table-responsive flex flex-col">
      <span class="mt-2 mb-2">Showing {{ start_num }} - {{ end_num }} of {{ num_records }} expenses.</span>
      <table class="table mb-">
        <thead class="thead-light">
          <tr>
            <th scope="col" class="title-sm">ID</th>
            <th scope="col" class="title-sm">Date</th>
            <th scope="col" class="title-sm">Amount</th>
            <th scope="col" class="title-sm">Category</th>
            {% comment %}
            <th scope="col" class="title-sm">Vendor</th>
            <th scope="col" class="title-sm">Description</th>
            <th scope="col" class="title-sm">Receipt</th>{% endcomment %}
          </tr>
        </thead>
        <tbody class="list-grou">
        
          {% for record in page_obj %}

          <tr class="click btn-link">
            <td >{{ record.pk }}</a></td>
            <td >{{ record.expense_date }}</td>
            <td >${{ record.amount }}</td>
            <td >{{ record.category }}</td>
            {% comment %}
            <td>{{ record.vendor }}</td>
            <td>{{ record.description }}</td>
            <td>{% if record.receipt %} Yes
              {% else %} {% endif %}</td>
              {% endcomment %}
          </tr>

          {% endfor %}

        </tbody>
        <tfoot>
          <tr class="thead-light">
            <td colspan="2" class="imp title-sm">Total:</td>
            <td colspan="2" class="imp title-sm">${{ page_total }}</td>
          </tr>
        </tfoot>
      </table>

      <div class="flex just-center">
        {% bootstrap_paginate page_obj range=10 %}
      </div>
      
    </div>
  
    {% else %}
        <p class="mt-3 ml-3 imp">No expenses found.</p>
    {% endif %}
  </div>
{% endblock content%}


{% block my_scripts %}

<!-- Declare global template variables -->
<script type="text/javascript">
  let page_number = "{{ page_number }}";
  let allDatesCheck = "{{ all_dates }}";
  let minAmount = "{{ min_amount }}";
  let maxAmount = "{{ max_amount }}";
  let hasReceipt = "{{ has_receipt }}";
  let highestAmount = "{{ highest_amount }}";
</script>

<!-- Adding the proper URL's to each pagination link and determining which page is active to add the correct class -->
<!-- <script src="../../../static/budget/scripts/addPaginationURLs.js"></script> -->

<!-- Makes each table row a URL -->
<script src="../../../static/budget/scripts/clickExpenseToRedirect.js"></script>

<!-- Outside scripts for date and date range picker -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>

<!-- Activate date picker calendars -->
<script src="../../../static/budget/scripts/activateDateCalendars.js"></script>

<!-- On checking of the date range checkbox, toggle between single date and date range -->
<script src="../../../static/budget/scripts/switchDateFilter.js"></script>

<!-- Amount range slider script from  -->
<script src="../../../static/budget/scripts/nouislider.js"></script>

<!-- Add default amounts in the input fields and automatically update them as the slider moves  -->
<script src="../../../static/budget/scripts/sliderFunctions.js"></script>

<!-- Disable/activate the date and date range pickers on click of the "all dates" checkbox -->
<script src="../../../static/budget/scripts/toggleActivationDatePicker.js"></script>

<!-- Defaulting the appropriate search fields -->
<script src="../../../static/budget/scripts/defaultValues.js"></script>


{% endblock %}
